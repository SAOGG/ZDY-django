<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>主界面</title>
    {% load static %}
    <link rel="stylesheet" href="{% static "home.css" %}">
</head>
<body>
 <!-- 新增：添加容器类，用于统一布局约束 -->
    <div class="container">
        <!-- 修改：消息提示包裹在messages类中 -->
        {% if messages %}
            <div class="messages">
                {% for m in messages %}
                    <p>{{ m }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <h1>主页</h1>

        {% if user.is_authenticated %}
            <div class="user-info">
    <p>欢迎，
        {% if user.profile.nickname %}
            {{ user.profile.nickname }}
        {% else %}
            {{ user.username }}
        {% endif %}
        ({{ user.email }})
    </p>

    <!-- 头像显示逻辑 -->
    {% if user.profile.avatar and user.profile.avatar.url %}
        <!-- 如果用户有头像，显示用户头像，并添加 onerror 备用 -->
        <img
            src="{{ user.profile.avatar.url }}"
            alt="{{ user.username }}的头像"
        >
    {% else %}
        <!-- 如果用户没有头像，直接显示默认头像 -->
        <img
            src="{% static 'image/default-avatar.jpg' %}"
            alt="默认头像"
        >
    {% endif %}

    <div class="user-actions">
        <a href="{% url 'upload_avatar' %}">修改头像和昵称</a> |
        <a href="{% url 'create_blog' %}">发布博客</a> |
        <a href="{% url 'blind_date' %}">相亲盲盒</a> |
        <a href="{% url 'logout' %}">退出</a>
    </div>
</div>

            <hr>

            <div class="blogs-section">
                <h2>博客列表</h2>
                {% for blog in blogs %}
                    <div class="blog-card">
                        <h3><a href="{% url 'blog_detail' blog.id %}">{{ blog.title }}</a></h3>
                        <!-- 修改：添加博客元信息类 -->
                        <p class="blog-meta">
                            作者:
                            {% if blog.author.profile.nickname %}
                                {{ blog.author.profile.nickname }}
                            {% else %}
                                {{ blog.author.username }}
                            {% endif %}
                            | 发布时间: {{ blog.created_at|date:"Y-m-d H:i" }}
                        </p>
                        <!-- 修改：添加博客内容类 -->
                        <p class="blog-content">{{ blog.content|truncatechars:200 }}</p>
                        <a href="{% url 'blog_detail' blog.id %}">查看全文及评论 ({{ blog.comments.count }})</a>
                    </div>
                    <hr>
                {% empty %}
                    <p>暂无博客，<a href="{% url 'create_blog' %}">发布第一篇博客</a></p>
                {% endfor %}
            </div>

        {% else %}
            <!-- 修改：未登录状态包裹在not-logged-in类中 -->
            <div class="not-logged-in">
                <a href="{% url 'login' %}">登录</a> | <a href="{% url 'register' %}">注册</a>
            </div>
        {% endif %}

        {% if user.is_staff %}
            <!-- 修改：管理员链接添加admin-link类 -->
            <a href="{% url 'users_table' %}" class="admin-link">点击查看用户</a>
        {% endif %}
    </div> <!-- 关闭container容器 -->
</body>
</html>