<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>好友申请 - 相亲盲盒系统</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- 背景图预留（替换为你的图片路径） -->
    <style>
        .request-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .request-item:last-child {
            border-bottom: none;
        }
        .user-card {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 页面标题 -->
        <h1 style="color: #FB7299; margin: 20px 0; text-align: center;">
            好友申请 <span style="background: #FB7299; color: white; padding: 2px 8px; border-radius: 10px; font-size: 16px;">{{ requests|length }}</span>
        </h1>

        <!-- 操作结果提示 -->
        {% if messages %}
            <div class="messages">
                {% for msg in messages %}
                    <p>{{ msg }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <!-- 好友申请列表卡片 -->
        <div class="card">
            {% if requests %}
                {% for req in requests %}
                    <div class="request-item">
                        <!-- 申请人信息 -->
                        <div class="user-card">
                            <!-- 申请人头像 -->
                            {% if req.from_user.profile.avatar %}
                                <img src="{{ req.from_user.profile.avatar.url }}" 
                                     alt="{{ req.from_user.username }}"
                                     style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
                            {% else %}
                                <img src="{% static 'image/default-avatar.jpg' %}" 
                                     alt="默认头像"
                                     style="width: 60px; height: 60px; border-radius: 50%;">
                            {% endif %}

                            <!-- 申请人资料 -->
                            <div>
                                <h3>
                                    {% if req.from_user.profile.nickname %}
                                        {{ req.from_user.profile.nickname }}
                                    {% else %}
                                        {{ req.from_user.username }}
                                    {% endif %}
                                </h3>
                                <p style="color: #666; font-size: 14px;">
                                    申请时间：{{ req.created_at|date:"Y-m-d H:i" }}
                                </p>
                                <!-- 展示申请人的基础信息（可选） -->
                                {% with profile=req.from_user.profile %}
                                        <p style="font-size: 13px; color: #999;">
                                            年龄：{{ profile.age|default:"未填写" }} | 
                                            性别：{{ profile.get_gender_text }}
                                        </p>
                                {% endwith %}
                            </div>
                        </div>

                        <!-- 操作按钮：接受/拒绝 -->
                        <div class="action-buttons">
                            <a href="{% url 'handle_friend_request' req.id 'accept' %}" class="btn">接受</a>
                            <a href="{% url 'handle_friend_request' req.id 'reject' %}" class="btn btn-secondary">拒绝</a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <!-- 空状态提示 -->
                <div style="padding: 40px; text-align: center;">
                    <img src="{% static 'image/Sylphiette.png' %}" alt="暂无申请" style="width: 120px; margin-bottom: 20px;">
                    <p style="color: #666; font-size: 16px;">暂无待处理的好友申请</p>
                </div>
            {% endif %}
        </div>

        <!-- 返回按钮 -->
        <div style="text-align: center; margin-top: 30px;">
            <a href="{% url 'home' %}" class="btn btn-secondary">返回主页</a>
        </div>
    </div>
</body>
</html>